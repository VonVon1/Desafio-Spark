name: Deploy Spark and Zeppelin

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ⬇️ Checkout repository
        uses: actions/checkout@v3

      - name: ⚙️ Set up K3s (Lightweight Kubernetes)
        uses: AbsaOSS/k3d-action@v2
        with:
          cluster-name: test-cluster
          wait: true

      - name: 📥 Install Helm
        uses: azure/setup-helm@v3
        with:
          version: v3.13.0

      - name: ⚙️ Install dependencies (GNU Make, etc.)
        run: |
          sudo apt-get update
          sudo apt-get install -y make

      - name: 🚀 Deploy Spark and Zeppelin
        run: |
          make deploy-all

      - name: 🔍 Check deployed resources
        run: |
          kubectl get all -n spark-technical-test-data-platform

